<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="project5.communication.minutesDao">
	<select id="totCnt" parameterType="minutesSch" resultType="int">
		select count(*)
			from minutes
			where 1=1
			<if test="topic!=null and topic!=''"> 
			and topic like '%'||#{topic}||'%'
			</if>
	</select>
	<select id="minutesList" parameterType="minutesSch" resultType="minutes" >
		SELECT *
		FROM (
			SELECT ROW_NUMBER() OVER (ORDER BY min.minutesKey  desc ) AS cnt, min.*, mem.name
			FROM minutes min, member mem
			WHERE 1=1
			<if test="topic!=null and topic!=''">
				AND topic like '%'||#{topic}||'%'
			</if>
			AND min.memberKey = mem.memberKey)
		WHERE cnt BETWEEN #{start} AND #{end}
	</select>

	<select id="getMinutes" parameterType="int" resultType="minutes">
		SELECT min.*, mem.name
		FROM minutes min, Member mem
		WHERE minuteskey=#{minuteskey}
		AND min.memberKey = mem.memberKey
	</select>

	<insert id="insMinutes" parameterType="minutes">
		INSERT INTO minutes VALUES(minutes_seq.nextval,2,1,#{topic},#{attendee},#{partname},to_date(#{conferenceDateS},'YYYY-MM-DD'),sysdate,sysdate,#{content},#{shorthand})
	</insert>

	<update id="uptMinutes" parameterType="minutes">
		UPDATE minutes
			SET topic = #{topic},
			attendee = #{attendee},
			partname = #{partname},
			conferenceDate = to_date(#{conferenceDateS},'YYYY-MM-DD'),
			updateDate = sysdate,
			content = #{content},
			shorthand = #{shorthand}
			WHERE minutesKey = #{minutesKey}
	</update>

	<delete id="delMinutes" parameterType="int">
		DELETE FROM minutes
		WHERE minutesKey=#{minutesKey}
	</delete>
</mapper>